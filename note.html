<!DOCTYPE html>
<html lang="pt_BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> | Devsnotes</title>
  <script src="js/util.js"></script>
  <script src="js/token.js"></script>
  <script>
    if (! token) {
      window.location = 'login.html'
    }

    const urlParams = new URLSearchParams(window.location.search)
    let id = urlParams.get('id')

    if (! id) {
      window.location = 'notes.html'
    }
  </script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <main>
    <div class="container">

      <div class="note">
        <h1 class="title"></h1>
        <p class="created_by">Autor: <span></span></p>
        <p class="body"></p>
      </div>

      <a id="btn-edit" href="form.html" class="btn btn-outline-primary">Editar</a>

      <form id="form-delete" action="notes.html" method="POST">
        <input type="hidden" name="method" value="DELETE">
        <button type="submit" class="btn btn-outline-danger">Apagar</button>
      </form>
      <a href="notes.html" class="btn btn-primary">Voltar</a>
    </div>
  </main>

  <script src="js/validation.js"></script>
  <script>
    let url = `http://localhost:8000/api/note/${id}`
    let btnEdit = document.querySelector('#btn-edit')
    let formDelete = document.querySelector('#form-delete')

    ajax(url, 'GET', show, null, token)

    btnEdit.href += `?id=${id}`
    formDelete.dataset.url = url
    formDelete.addEventListener('submit', e => {
      if (confirm('Deseja mesmo apagar a nota?')) {
        return Validator.handleSubmit(e, formDelete, () => {}, token)
      }
      return Validator.handleSubmit(e)
    })

    function show(res) {
      let note = res['note']

      if (! note) {
        window.location = 'notes.html'
      }

      document.title = note['title'] + ' ' + document.title

      document.querySelector('.note .title').innerHTML = note['title']
      document.querySelector('.note .created_by span').innerHTML = note['created_by']
      document.querySelector('.note .body').innerHTML = note['body']
    }

    function processDelete(res, status) {
      console.log(res, status)
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
</body>
</html>